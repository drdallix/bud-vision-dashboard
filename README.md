DoobieDB - AI-Powered Cannabis Strain Analyzer
DoobieDB is an intelligent application designed to provide rich, accurate, and engaging information about cannabis strains. Instead of relying on static databases, it uses a state-of-the-art AI generation engine to create dynamic, natural-sounding, and factually-grounded strain profiles in real-time.

This document focuses on the architecture and prompt engineering strategy behind the AI generation core of the application.

Core Feature: The AI Generation Engine
The heart of DoobieDB is a Supabase Edge Function that orchestrates a sophisticated process to turn a simple user query (e.g., "gg4") into a complete, structured, and well-written strain profile.

Our approach has evolved into a single, highly-engineered AI call for core content generation. This was a deliberate design choice to ensure data consistency and avoid the complexities and potential type-safety issues of a multi-call pipeline for a single data object. This single call is then followed by secondary enhancement calls to build out rich UI components.

Prompt Engineering Strategy
The quality of the AI's output is almost entirely dependent on the quality of the prompt. We use a single, comprehensive system prompt for OpenAI's gpt-4o model that combines several advanced techniques:

Persona-Driven Guidance: The AI is instructed to act as "Strain Genius," an expert cannabis writer and historian. This primes the model to adopt the desired tone and level of expertise.
Principle-Based Rules: Instead of rigid commands, we provide "Guiding Principles" that encourage the AI to prioritize authenticity and natural language while still adhering to critical constraints.
Few-Shot Learning: The prompt contains five complete, high-quality examples of perfect outputs, one for each major strain type (Sativa, Sativa-Dominant, Hybrid, Indica-Dominant, Indica). This is the most critical technique, as it provides a clear and diverse pattern for the AI to follow, dramatically improving its reliability.
Emphasis on Natural Language: The prompt explicitly instructs the AI to be an engaging writer, weaving facts and data into a compelling narrative rather than just listing them.
A Deeper Dive into the AI's Task
The AI is tasked with generating a single JSON object based on the following key requirements, all enforced by the prompt:

Factual Grounding: The description for each strain must be factually accurate and include:

Parent Strains: The known genetic lineage of the strain (e.g., "a cross between Cherry Pie and Girl Scout Cookies").
A Verifiable Fact: A unique piece of information, such as winning a Cannabis Cup, its origin story, or its year of creation.
Responsible AI Sourcing: To build user trust and ensure transparency, the AI must conclude every description with a source attribution, for example: Profile information synthesized from leading cannabis resources, including Leafly.

Deterministic Business Logic: The thc value is not generated by the AI. It is calculated deterministically based on the strain name before the main AI call, ensuring consistency and control over product data. The AI is then instructed to use this exact value.

Controlled Vocabulary: To ensure consistency with the UI, the AI selects effects and flavors from a predefined list of supported terms.

The Generation Process: A Simplified Flow
User Input: The function receives a textQuery (e.g., "wedding cake").
Deterministic THC Generation: The strain name is used to generate a deterministic THC percentage (e.g., 22.5%) using the thcGenerator.ts logic. This ensures the same strain name always yields the same THC value.
Core Profile Generation (The Main AI Call):
The highly-engineered prompt from openai.ts is assembled, including the deterministic THC value.
A single call is made to gpt-4o with a temperature of 0.6. This temperature is the sweet spotâ€”high enough for creative, natural language, but low enough to remain factual and on-topic.
The AI returns a single, complete JSON object containing the name, type, description, effects, flavors, terpenes, etc.
UI Profile Enhancement (Secondary AI Calls):
The effects and flavors arrays from the main profile are passed to two smaller, specialized AI calls (createEffectProfilesMessages and createFlavorProfilesMessages).
These calls return structured data for the UI, including intensity, emoji, and color for each effect and flavor, allowing for rich data visualizations.
Final Assembly: The core profile and the enhanced UI profiles are combined into the final object and returned to the client.
Technology Stack
Backend: Supabase Edge Functions
Runtime: Deno
Language: TypeScript
AI Model: OpenAI GPT-4o
Environment Variables
To run this function, the following environment variables must be configured in your Supabase project:

OPENAI_API_KEY: Your secret key for the OpenAI API.
SUPABASE_URL: Your Supabase project URL.
SUPABASE_SERVICE_ROLE_KEY: Your Supabase service role key for database operations.
Contributing
This AI engine is powerful but can always be improved. Areas for future contribution include:

Expanding Image Analysis: The codebase contains dormant functions for image-based queries. A future goal is to build out a robust prompt that can identify strains from user-uploaded images.
Refining Effect/Flavor Constants: The profileConstants.ts file can be expanded with more supported effects, flavors, colors, and emojis to enrich the UI.
A/B Testing Prompts: Experimenting with different prompt structures, tones, or few-shot examples to further enhance the quality and natural language of the AI's output.

Sources
